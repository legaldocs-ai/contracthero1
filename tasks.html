<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aurum Task Desk — Your Personal Desk</title>
  <link rel="icon" type="image/png" href="favicon.png" />
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: radial-gradient(circle at top, #fdf7eb 0%, #f5f1ff 40%, #eef3ff 100%);
      color: #1f2430;
      line-height: 1.6;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    .container {
      max-width: 1180px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Navbar */
    .navbar {
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(14px);
      background: rgba(255, 255, 255, 0.9);
      border-bottom: 1px solid rgba(210, 197, 140, 0.4);
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav-left {
      font-size: 20px;
      font-weight: 800;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: #343536;
    }

    .nav-right a {
      margin-left: 22px;
      font-size: 14px;
      opacity: 0.85;
    }

    .nav-right a:hover {
      opacity: 1;
      color: #d49b1f;
    }

    /* Header */
    .page-header {
      margin-top: 26px;
      margin-bottom: 10px;
    }

    .desk-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #c08b20;
      margin-bottom: 6px;
    }

    .header-title {
      font-size: 30px;
      font-weight: 800;
      color: #23262f;
      margin-bottom: 6px;
    }

    .header-sub {
      font-size: 14px;
      color: #5b6273;
      max-width: 660px;
    }

    /* Layout */
    .layout {
      display: grid;
      grid-template-columns: minmax(0, 0.95fr) minmax(0, 1.1fr);
      gap: 22px;
      margin-top: 24px;
      align-items: flex-start;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: #ffffff;
      border-radius: 18px;
      border: 1px solid rgba(213, 208, 192, 0.8);
      padding: 18px 18px 20px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.08);
    }

    .card-title {
      font-size: 17px;
      font-weight: 700;
      margin-bottom: 6px;
      color: #22252f;
    }

    .card-sub {
      font-size: 13px;
      color: #616575;
      margin-bottom: 14px;
    }

    .desk-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 8px 0 10px;
      font-size: 12px;
    }

    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(210, 165, 60, 0.8);
      background: linear-gradient(135deg, #fff7e2, #fbe4b5);
      color: #7f5a0f;
      font-weight: 500;
    }

    .pill-soft {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(120, 158, 240, 0.6);
      background: linear-gradient(135deg, #eef4ff, #dfebff);
      color: #2d4a95;
      font-weight: 500;
    }

    .hint {
      font-size: 12px;
      color: #7a7f8b;
      margin-top: 4px;
    }

    label {
      display: block;
      font-size: 13px;
      margin-bottom: 4px;
      color: #2a2f3b;
    }

    input[type="text"],
    select,
    textarea {
      width: 100%;
      padding: 9px 10px;
      border-radius: 9px;
      border: 1px solid rgba(157, 165, 189, 0.8);
      background: #fbfbff;
      color: #202430;
      font-size: 13px;
      font-family: inherit;
    }

    textarea {
      min-height: 140px;
      resize: vertical;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #d19a26;
      box-shadow: 0 0 0 1px rgba(209, 154, 38, 0.35);
      background: #ffffff;
    }

    .inline {
      display: flex;
      gap: 10px;
      margin-top: 8px;
    }

    .inline .field {
      flex: 1;
    }

    .btn-primary {
      padding: 9px 18px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #f4b738, #d48c1a);
      color: #15100a;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin-right: 8px;
      box-shadow: 0 10px 20px rgba(204, 140, 18, 0.3);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }

    .btn-secondary {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(210, 165, 60, 0.6);
      background: #fff7e2;
      color: #8a6215;
      font-size: 12px;
      cursor: pointer;
      margin-top: 4px;
    }

    .btn-secondary:hover {
      background: #fbe8bd;
    }

    .status-text {
      font-size: 12px;
      color: #6a7282;
      margin-top: 6px;
      min-height: 16px;
    }

    .result-box {
      margin-top: 10px;
      padding: 12px;
      border-radius: 12px;
      background: linear-gradient(145deg, #fdfbff, #f4f5ff);
      border: 1px solid rgba(188, 193, 214, 0.9);
      font-size: 13px;
      white-space: pre-wrap;
      max-height: 420px;
      overflow-y: auto;
      color: #252a3a;
    }

    .result-empty {
      font-size: 13px;
      color: #8a8fa0;
    }

    .footer {
      margin-top: 40px;
      border-top: 1px solid rgba(214, 205, 173, 0.6);
      padding: 18px 0 26px;
      text-align: center;
      font-size: 12px;
      color: #7c7f8a;
    }

    /* (名字 overlay 如果以后要用，这里保留样式；现在默认不弹出) */
    .name-overlay {
      position: fixed;
      inset: 0;
      background: rgba(10, 11, 20, 0.32);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 30;
    }

    .name-card {
      background: #ffffff;
      border-radius: 14px;
      border: 1px solid rgba(210, 165, 60, 0.7);
      padding: 18px 18px 16px;
      max-width: 360px;
      width: 90%;
      color: #1f2430;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.18);
    }

    .name-card h2 {
      font-size: 18px;
      margin: 0 0 6px;
    }

    .name-card p {
      font-size: 13px;
      color: #5e6475;
      margin: 0 0 10px;
    }

    .name-input-row {
      margin-top: 8px;
    }

    .name-input-row input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid rgba(157, 165, 189, 0.9);
      background: #fbfbff;
    }

    .btn-small {
      margin-top: 10px;
      padding: 7px 14px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #f2b63a, #d18b1b);
      color: #15100a;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      box-shadow: 0 10px 18px rgba(210, 138, 27, 0.32);
    }
  </style>
</head>
<body>
  <!-- NAVBAR -->
  <header class="navbar">
    <div class="nav-left">AURUM TASK DESK</div>
    <nav class="nav-right">
      <a href="index.html">Home</a>
      <a href="tasks.html">Task Marketplace</a>
      <a href="pricing.html">Pricing</a>
      <a href="contact.html">Contact</a>
    </nav>
  </header>

  <!-- NAME OVERLAY（现在默认隐藏，如需启用可改 JS） -->
  <div class="name-overlay" id="nameOverlay" style="display:none;">
    <div class="name-card">
      <h2>Your Personal Desk</h2>
      <p>
        Before we start, how should the Desk address you?<br />
        (First name only is fine.)
      </p>
      <div class="name-input-row">
        <input type="text" id="nameInput" placeholder="Mike, John, David..." />
      </div>
      <button class="btn-small" id="saveNameBtn">Save and open my Desk</button>
    </div>
  </div>

  <main class="container">
    <!-- Header -->
    <section class="page-header">
      <div class="desk-label">PERSONAL DESK</div>
      <h1 class="header-title" id="headerTitle">Your Aurum Desk</h1>
      <p class="header-sub" id="headerSub">
        This is your private writing desk. Describe what you want to say in plain language, and the Desk
        will shape it into a calm, respectful draft for older US/EU readers.
      </p>
    </section>

    <!-- Main layout -->
    <section class="layout">
      <!-- LEFT: Info + guidance -->
      <aside class="card">
        <h2 class="card-title" id="greetingTitle">Welcome back.</h2>
        <p class="card-sub" id="greetingSub">
          Use this Desk whenever you need quiet, careful writing support — especially for sensitive or
          emotionally loaded situations.
        </p>

        <div class="desk-meta">
          <span class="pill" id="planPill">Aurum Desk</span>
          <span class="pill-soft" id="usagePill">Free 30% preview · $19.9 unlock</span>
        </div>

        <p class="card-sub" id="planDesc">
          Each draft is written in a calm, low-drama style. You see a free 30% preview of the full draft.
          The remaining content is softly blurred until you choose to unlock it.
        </p>

        <p class="hint">
          Ideal for apologies, clarifications, family messages, replies, and short posts for veterans,
          truck drivers, engineers, and other older professionals.
        </p>
      </aside>

      <!-- RIGHT: Task form + AI result -->
      <section class="card">
        <h2 class="card-title">Submit a task to your Desk</h2>
        <p class="card-sub">
          Describe the situation in your own words. The Desk will generate a draft, showing you a
          clear 30% preview. The rest is visible but blurred until payment.
        </p>

        <form id="deskForm">
          <div class="field">
            <label for="taskType">Task type</label>
            <select id="taskType">
              <option value="email">Email / Letter</option>
              <option value="family">Family communication</option>
              <option value="business">Business text / policy / notice</option>
              <option value="reply">Reply to an existing message</option>
              <option value="linkedin">LinkedIn post or update</option>
              <option value="speech">Short speech / talking points</option>
              <option value="other">Other (describe below)</option>
            </select>
          </div>

          <div class="inline">
            <div class="field">
              <label for="tone">Tone</label>
              <select id="tone">
                <option value="calm">Calm and respectful</option>
                <option value="professional">Professional and clear</option>
                <option value="warm">Warm and supportive</option>
                <option value="firm">Firm but polite</option>
                <option value="simple">Very simple English</option>
              </select>
            </div>
            <div class="field">
              <label for="language">Language</label>
              <select id="language">
                <option value="english">English</option>
                <option value="bilingual">English + Chinese</option>
                <option value="chinese">Chinese only</option>
              </select>
            </div>
          </div>

          <div class="field" style="margin-top:10px;">
            <label for="audience">Who is this for?</label>
            <input type="text" id="audience" placeholder="My daughter, my ex-wife, my boss, a client, LinkedIn readers..." />
          </div>

          <div class="field" style="margin-top:10px;">
            <label for="details">What do you want to say? (details)</label>
            <textarea id="details" placeholder="Explain what happened, what you want to say, any key facts or dates. The Desk will shape this into a clear draft."></textarea>
          </div>

          <div style="margin-top:12px;">
            <button type="button" class="btn-primary" id="generateBtn">Generate draft preview</button>
            <button type="button" class="btn-secondary" id="copyBtn" disabled>Copy current draft</button>
            <div class="status-text" id="statusText"></div>
          </div>
        </form>

        <div id="resultBox" class="result-box" style="margin-top:14px;">
          <div class="result-empty">
            No draft yet. Submit a task on this page and your Desk will generate a 30% preview of the full draft.
          </div>
        </div>
      </section>
    </section>

    <footer class="footer">
      © 2025 Aurum Task Desk — Personal Desk Space
    </footer>
  </main>

  <script>
    // Cloudflare Worker backend
    const WORKER_API_URL = "https://aurum-task-worker.sophieinbg.workers.dev/api/generate";

    const nameOverlay = document.getElementById("nameOverlay");
    const nameInput = document.getElementById("nameInput");
    const saveNameBtn = document.getElementById("saveNameBtn");

    const greetingTitle = document.getElementById("greetingTitle");
    const greetingSub = document.getElementById("greetingSub");
    const planPill = document.getElementById("planPill");
    const usagePill = document.getElementById("usagePill");
    const planDesc = document.getElementById("planDesc");

    const taskTypeEl = document.getElementById("taskType");
    const toneEl = document.getElementById("tone");
    const languageEl = document.getElementById("language");
    const audienceEl = document.getElementById("audience");
    const detailsEl = document.getElementById("details");

    const generateBtn = document.getElementById("generateBtn");
    const copyBtn = document.getElementById("copyBtn");
    const statusText = document.getElementById("statusText");
    const resultBox = document.getElementById("resultBox");

    let currentDraft = "";

    function setupDeskUI() {
      planPill.textContent = "Aurum Desk";
      usagePill.textContent = "Free 30% preview · $19.9 unlock";
      planDesc.textContent =
        "Each draft is written in a calm, low-drama style. You see a free 30% preview, " +
        "and the rest of the text stays softly blurred until you choose to unlock it.";
      greetingTitle.textContent = "Welcome back.";
      greetingSub.textContent =
        "Describe what you want to say, and the Desk will shape it into a clear, respectful draft for you.";
    }

    function initName() {
      const stored = localStorage.getItem("aurum_desk_name") || "";
      if (stored) {
        // 不再展示具体名字，只保留通用欢迎语
        greetingTitle.textContent = "Welcome back.";
        greetingSub.textContent =
          "Your Desk is active. Describe what you want to say, and the Desk will shape it into a clear, respectful draft.";
        nameOverlay.style.display = "none";
      } else {
        // 如果想重新启用采名字，把这一行改成 'flex'
        nameOverlay.style.display = "none";
      }
    }

    if (saveNameBtn) {
      saveNameBtn.addEventListener("click", () => {
        const name = nameInput.value.trim();
        if (!name) {
          alert("Please enter a first name.");
          return;
        }
        localStorage.setItem("aurum_desk_name", name);
        nameOverlay.style.display = "none";
      });
    }

    // 生成草稿（30% 清晰 + 70% 半透明模糊遮罩）
    generateBtn.addEventListener("click", async () => {
      const taskType = taskTypeEl.value;
      const tone = toneEl.value;
      const language = languageEl.value;
      const audience = audienceEl.value.trim();
      const details = detailsEl.value.trim();
      const name = localStorage.getItem("aurum_desk_name") || "";

      if (!details) {
        alert("Please describe the situation or what you want to say.");
        return;
      }

      generateBtn.disabled = true;
      generateBtn.textContent = "Generating...";
      statusText.textContent = "Your Desk is drafting a calm, clear message...";
      resultBox.innerHTML = "";

      try {
        let prompt =
          "You are Aurum Task Desk AI. You support older US and EU men (50+), " +
          "including veterans, truck drivers, engineers and business owners, with calm, clear, respectful writing.\n\n";

        if (name) prompt += "Client first name: " + name + ".\n";
        prompt += "Task type: " + taskType + ".\n";
        prompt += "Tone: " + tone + ".\n";
        prompt += "Language: " + language + " (if bilingual, answer in English first then Chinese).\n";
        if (audience) prompt += "Audience: " + audience + ".\n";
        prompt += "Details: " + details + ".\n\n";

        prompt +=
          "Write a complete draft that the client can copy and send directly. " +
          "Avoid overly fancy language. Sound mature, respectful, and steady. " +
          "If language = Chinese, reply in Chinese. If bilingual, provide English first, then Chinese.\n";

        const res = await fetch(WORKER_API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt })
        });

        const data = await res.json();

        if (!res.ok || !data.ok) {
          const msg = data && data.error ? data.error : "HTTP " + res.status;
          throw new Error(msg);
        }

        const full = data.text || "No content returned from Aurum Desk AI.";
        currentDraft = full;

        // ---- 30% 清晰预览 + 70% 半透明模糊遮罩 ----
        const previewRatio = 0.3;
        const previewLength = Math.max(40, Math.floor(full.length * previewRatio));
        const previewText = full.slice(0, previewLength);
        const hiddenText = full.slice(previewLength);

        resultBox.innerHTML = "";

        const previewDiv = document.createElement("div");
        previewDiv.textContent = previewText;
        previewDiv.style.marginBottom = "12px";
        resultBox.appendChild(previewDiv);

        // 剩余 70%：半透明 + 模糊遮罩
        const blurContainer = document.createElement("div");
        blurContainer.style.position = "relative";
        blurContainer.style.marginTop = "10px";
        blurContainer.style.padding = "12px";
        blurContainer.style.borderRadius = "10px";
        blurContainer.style.background = "rgba(240, 242, 255, 0.9)";
        blurContainer.style.color = "rgba(40, 44, 60, 0.3)";
        blurContainer.style.whiteSpace = "pre-wrap";
        blurContainer.style.userSelect = "none";
        blurContainer.style.overflow = "hidden";

        // 底层仍放完整剩余文本，但变浅
        blurContainer.textContent = hiddenText;

        // 覆盖层：模糊 + 按钮
        const overlay = document.createElement("div");
        overlay.style.position = "absolute";
        overlay.style.inset = "0";
        overlay.style.background =
          "linear-gradient(to bottom, rgba(248, 244, 230, 0.7), rgba(232, 231, 245, 0.9))";
        overlay.style.backdropFilter = "blur(6px)";
        overlay.style.borderRadius = "10px";
        overlay.style.display = "flex";
        overlay.style.flexDirection = "column";
        overlay.style.alignItems = "center";
        overlay.style.justifyContent = "center";
        overlay.style.color = "#815712";
        overlay.style.fontSize = "14px";
        overlay.style.textAlign = "center";
        overlay.style.padding = "20px";

        const unlockBtn = document.createElement("button");
        unlockBtn.textContent = "Unlock full draft — $19.9";
        unlockBtn.style.padding = "10px 20px";
        unlockBtn.style.border = "none";
        unlockBtn.style.borderRadius = "999px";
        unlockBtn.style.cursor = "pointer";
        unlockBtn.style.fontSize = "15px";
        unlockBtn.style.fontWeight = "600";
        unlockBtn.style.background = "linear-gradient(135deg,#f4b738,#d48c1a)";
        unlockBtn.style.color = "#15100a";
        unlockBtn.style.boxShadow = "0 10px 20px rgba(210,140,26,0.35)";
        unlockBtn.style.marginBottom = "6px";

        unlockBtn.addEventListener("click", () => {
          window.location.href = "pricing.html#unlock";
        });

        const tip = document.createElement("div");
        tip.innerHTML =
          "Full content is softly locked.<br>Pay <b>$19.9</b> to access 100% of this draft.";
        tip.style.opacity = "0.95";

        overlay.appendChild(unlockBtn);
        overlay.appendChild(tip);

        blurContainer.appendChild(overlay);
        resultBox.appendChild(blurContainer);

        statusText.textContent =
          "30% preview displayed — remaining content is blurred until you unlock it.";
        copyBtn.disabled = true;
      } catch (err) {
        console.error(err);
        resultBox.innerHTML =
          '<div class="result-empty">Something went wrong while generating your draft: ' +
          (err.message || String(err)) +
          "</div>";
        statusText.textContent = "";
        copyBtn.disabled = true;
      } finally {
        generateBtn.disabled = false;
        generateBtn.textContent = "Generate draft preview";
      }
    });

    // Copy 按钮目前禁用（保留逻辑，方便以后对订阅用户开放）
    copyBtn.addEventListener("click", async () => {
      if (!currentDraft) {
        alert("There is no draft to copy yet.");
        return;
      }
      try {
        await navigator.clipboard.writeText(currentDraft);
        statusText.textContent = "Draft copied to your clipboard.";
      } catch (e) {
        alert("Copy failed. Please select the text manually and copy.");
      }
    });

    setupDeskUI();
    initName();
  </script>
</body>
</html>
