<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Aurum Task Desk — Preview & Full Letter Desk</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Favicon -->
  <link rel="icon" href="favicon.png" />
  <link rel="icon" type="image/png" href="favicon.png" />

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-NEY7RNB5S"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-NEY7RNB5S');
  </script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    :root {
      --bg-deep: #020617;
      --bg-card: #020617;
      --border-subtle: rgba(148, 163, 184, 0.35);
      --text-main: #e5e7eb;
      --text-soft: #cbd5f5;
      --gold: #fbbf24;
      --accent-blue: #38bdf8;
      --shadow-strong: 0 32px 120px rgba(0,0,0,0.9);
      --radius-xl: 24px;
      --radius-lg: 16px;
      --radius-pill: 999px;
      --blur-strong: 40px;
    }

    body {
      min-height: 100vh;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui,
        "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top, #020617 0%, #020617 40%, #000 100%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 24px 12px 48px;
    }
    .page-shell {
      width: 100%;
      max-width: 1120px;
      margin: 0 auto;
    }

    /* === 顶部导航样式：和首页保持一致 === */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 10px 18px;
      margin-bottom: 18px;
      border-radius: 999px;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.9), rgba(2, 6, 23, 0.96));
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 14px 40px rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(18px);
      position: sticky;
      top: 10px;
      z-index: 30;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-mark {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background:
        conic-gradient(
          from 210deg,
          #0ea5e9,
          #22d3ee,
          #fbbf24,
          #eab308,
          #0ea5e9
        );
      padding: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow:
        0 0 0 1px rgba(148, 163, 184, 0.9),
        0 0 40px rgba(14, 165, 233, 0.8);
    }

    .brand-mark-inner {
      width: 100%;
      height: 100%;
      border-radius: inherit;
      background: radial-gradient(circle at 30% 20%, #0f172a, #020617);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      letter-spacing: 0.06em;
      font-size: 0.8rem;
      color: #fefce8;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 1px;
    }

    .brand-title {
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .brand-sub {
      font-size: 0.72rem;
      color: var(--text-soft);
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    nav {
      display: flex;
      align-items: center;
      gap: 14px;
      font-size: 0.8rem;
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .nav-link {
      color: var(--text-soft);
      text-decoration: none;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid transparent;
      transition: all 0.16s ease-out;
      cursor: pointer;
      white-space: nowrap;
    }
    .nav-link:hover {
      color: #e5e7eb;
      border-color: rgba(148, 163, 184, 0.6);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.9), rgba(2, 6, 23, 0.9));
    }

    .nav-link--active {
      color: var(--gold);
      border-color: rgba(251, 191, 36, 0.8);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.85), rgba(2, 6, 23, 0.95));
      box-shadow: 0 0 0 1px rgba(251, 191, 36, 0.5);
    }

    .lang-toggle {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      overflow: hidden;
      font-size: 0.75rem;
    }

    .lang-btn {
      padding: 4px 10px;
      border: none;
      background: transparent;
      color: var(--text-soft);
      cursor: pointer;
      transition: all 0.14s ease-out;
    }
    .lang-btn.active {
      background: linear-gradient(135deg, #fbbf24, #eab308);
      color: #020617;
      font-weight: 600;
    }

    .login-btn {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.9), rgba(2, 6, 23, 0.96));
      color: #e5e7eb;
      font-size: 0.8rem;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.18s ease-out;
      white-space: nowrap;
    }
    .login-btn span.icon {
      font-size: 0.9rem;
    }
    .login-btn:hover {
      border-color: var(--gold);
      color: #fefce8;
      box-shadow: 0 0 0 1px rgba(251, 191, 36, 0.6),
        0 12px 30px rgba(8, 47, 73, 0.9);
    }

    @media (max-width: 900px) {
      header {
        border-radius: 18px;
        padding-inline: 14px;
      }
    }
    @media (max-width: 640px) {
      header {
        flex-wrap: wrap;
        row-gap: 8px;
      }
      nav {
        width: 100%;
        justify-content: flex-end;
        flex-wrap: wrap;
      }
      .nav-links {
        flex-wrap: wrap;
      }
      body {
        padding: 16px 8px 32px;
      }
    }

    /* 主体布局 */
    .desk-main-card {
      margin-top: 6px;
      border-radius: var(--radius-xl);
      background:
        radial-gradient(circle at top left, rgba(59, 130, 246, 0.16) 0%, transparent 60%),
        radial-gradient(circle at bottom right, rgba(251, 191, 36, 0.06) 0%, transparent 55%),
        rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(15, 23, 42, 0.95);
      box-shadow: var(--shadow-strong);
      padding: 20px 22px 22px;
      backdrop-filter: blur(var(--blur-strong));
    }

    .flow-head {
      border-radius: var(--radius-lg);
      border: 1px dashed rgba(148, 163, 184, 0.6);
      padding: 16px 16px 14px;
      background:
        radial-gradient(circle at top left, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.96));
      margin-bottom: 16px;
    }
    .flow-head-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      gap: 8px;
    }
    .flow-pill {
      font-size: 11px;
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .flow-pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0%, #22c55e, #15803d);
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.16);
    }
    .flow-title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .flow-title {
      font-size: 17px;
      font-weight: 600;
      letter-spacing: 0.01em;
    }
    .flow-subtitle {
      font-size: 12px;
      color: var(--text-soft);
      max-width: 680px;
    }
    .flow-chips {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-top: 10px;
    }
    .flow-chip {
      border-radius: 999px;
      padding: 8px 12px;
      border: 1px dashed rgba(148, 163, 184, 0.5);
      font-size: 11px;
      color: var(--text-soft);
      background: radial-gradient(circle at top,#020617,#020617);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .flow-chip span.label {
      font-weight: 500;
      color: #e5e7eb;
    }
    .flow-chip-badge {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--text-soft);
    }

    .desk-layout {
      display: grid;
      grid-template-columns: minmax(0, 370px) minmax(0, 1fr);
      gap: 16px;
      align-items: stretch;
    }

    .service-card {
      border-radius: var(--radius-lg);
      border: 1px solid rgba(148, 163, 184, 0.4);
      background:
        radial-gradient(circle at top left, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.98));
      padding: 14px 14px 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .service-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 4px;
    }
    .service-card-title {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-soft);
    }
    .service-card-mini {
      font-size: 11px;
      color: var(--text-soft);
    }

    .service-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .service-item {
      position: relative;
      border-radius: 999px;
      padding: 10px 12px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background:
        radial-gradient(circle at top left, rgba(15,23,42,0.95), rgba(15,23,42,0.98));
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: space-between;
      cursor: pointer;
      overflow: hidden;
      transition: border-color 0.14s ease, box-shadow 0.16s ease,
                  transform 0.14s ease, background 0.16s ease;
    }
    .service-item::before {
      content: "";
      position: absolute;
      inset: 0;
      opacity: 0;
      background: radial-gradient(circle at 0 0, rgba(59, 130, 246, 0.2), transparent 60%);
      transition: opacity 0.18s ease;
      pointer-events: none;
    }
    .service-item:hover::before {
      opacity: 1;
    }
    .service-item:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 60px rgba(15, 23, 42, 0.9);
    }
    .service-item.active {
      border-color: var(--gold);
      box-shadow: 0 20px 70px rgba(15, 23, 42, 1);
      background:
        linear-gradient(120deg, rgba(251, 191, 36, 0.08), rgba(15, 23, 42, 0.98));
    }

    .service-item-main {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
      min-width: 0;
    }
    .service-icon-wrap {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 30% 0%, #020617,#020617);
      box-shadow: 0 7px 20px rgba(15,23,42,0.9);
      flex-shrink: 0;
    }
    .service-icon-inner {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: radial-gradient(circle at 30% 0%, #0f172a,#020617);
    }
    .service-text-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }
    .service-title {
      font-size: 13px;
      font-weight: 600;
      color: #e5e7eb;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .service-sub {
      font-size: 11px;
      color: rgba(148, 163, 184, 0.95);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .service-item.active .service-title {
      color: #f9fafb;
    }
    .service-item.active .service-sub {
      color: rgba(209, 213, 219, 0.95);
    }
    .service-price {
      font-size: 12px;
      font-weight: 600;
      color: var(--gold);
      white-space: nowrap;
      margin-left: 8px;
    }

    .ai-panel {
      border-radius: var(--radius-lg);
      border: 1px solid rgba(148, 163, 184, 0.4);
      background:
        radial-gradient(circle at top right, rgba(56, 189, 248, 0.16), transparent 55%),
        radial-gradient(circle at bottom left, rgba(251, 191, 36, 0.12), transparent 60%),
        rgba(15, 23, 42, 0.96);
      padding: 14px 14px 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: relative;
      overflow: hidden;
    }
    .ai-panel::after {
      content: "DRAFT DESK";
      position: absolute;
      right: -20px;
      bottom: -10px;
      font-size: 40px;
      letter-spacing: 0.15em;
      color: rgba(15, 23, 42, 0.8);
      font-weight: 700;
      pointer-events: none;
    }
    .ai-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .ai-title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .ai-title {
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .ai-title-pill {
      font-size: 10px;
      padding: 1px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--text-soft);
    }
    .ai-subtitle {
      font-size: 12px;
      color: var(--text-soft);
      max-width: 440px;
    }
    .ai-hint-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 4px;
    }
    .ai-hint-pill {
      font-size: 10px;
      border-radius: 999px;
      border: 1px dashed rgba(148, 163, 184, 0.5);
      padding: 2px 8px;
      color: var(--text-soft);
      background: rgba(15, 23, 42, 0.9);
    }

    .ai-form {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px 10px;
      margin-top: 4px;
    }
    .ai-form-full {
      grid-column: 1 / -1;
    }
    .ai-label {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 3px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .ai-label span.badge {
      font-size: 9px;
      border-radius: 999px;
      padding: 0 6px;
      border: 1px solid rgba(148, 163, 184, 0.7);
    }
    .ai-input,
    .ai-select,
    .ai-textarea {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      font-size: 12px;
      padding: 6px 8px;
      outline: none;
      resize: vertical;
      min-height: 0;
      transition: border-color 0.14s ease, box-shadow 0.14s ease, background 0.14s ease;
    }
    .ai-input:focus,
    .ai-select:focus,
    .ai-textarea:focus {
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.45);
      background: rgba(15, 23, 42, 0.96);
    }
    .ai-select {
      padding-right: 22px;
    }
    .ai-textarea {
      min-height: 80px;
      line-height: 1.4;
    }

    .ai-attachment-hint {
      font-size: 10px;
      color: var(--text-soft);
      margin-top: 2px;
    }

    .ai-footer-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 4px;
      flex-wrap: wrap;
    }
    .ai-left-buttons {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }
    .ai-secondary-btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      padding: 6px 11px;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      transition: all 0.14s ease;
    }
    .ai-secondary-btn:hover {
      background: rgba(15, 23, 42, 1);
      box-shadow: 0 10px 36px rgba(15, 23, 42, 0.9);
      transform: translateY(-0.5px);
    }
    .ai-generate-btn {
      border-radius: 999px;
      border: none;
      background: linear-gradient(120deg,#22c55e,#16a34a);
      color: #022c22;
      padding: 7px 18px;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 16px 55px rgba(6, 95, 70, 0.7);
      transition: transform 0.14s ease, box-shadow 0.14s ease, filter 0.14s ease;
      white-space: nowrap;
    }
    .ai-generate-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 22px 70px rgba(6, 95, 70, 0.9);
      filter: brightness(1.02);
    }
    .ai-generate-btn[disabled] {
      opacity: 0.7;
      cursor: default;
      transform: none;
      box-shadow: 0 12px 32px rgba(6, 95, 70, 0.5);
    }
    .ai-status {
      font-size: 11px;
      color: var(--text-soft);
    }

    .ai-preview-wrapper {
      position: relative;
      margin-top: 8px;
    }

    .ai-preview-box {
      border-radius: 12px;
      border: 1px dashed rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      padding: 8px 10px;
      max-height: 180px;
      overflow: auto;
      font-size: 12px;
      line-height: 1.45;
      white-space: pre-wrap;
      color: #e5e7eb;
    }
    .ai-preview-placeholder {
      color: rgba(191, 219, 254, 0.95);
      font-size: 11px;
    }

    /* 玻璃遮罩：只盖下面 60%，顶部约 40% 清晰 */
    .ai-preview-overlay {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      top: 40%;
      display: none;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 10px;
      background: linear-gradient(
        to bottom,
        rgba(15,23,42,0),
        rgba(15,23,42,0.65),
        rgba(15,23,42,0.92)
      );
      backdrop-filter: blur(6px);
      border-radius: 12px;
      pointer-events: none;
    }
    .ai-preview-overlay-inner {
      pointer-events: auto;
      max-width: 90%;
    }
    .ai-overlay-title {
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .ai-overlay-text {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 8px;
    }
    .ai-overlay-btn {
      border-radius: 999px;
      border: 1px solid rgba(248, 250, 252, 0.7);
      background: rgba(15, 23, 42, 0.95);
      color: #f9fafb;
      padding: 5px 12px;
      font-size: 11px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.14s ease;
    }
    .ai-overlay-btn:hover {
      background: #fbbf24;
      color: #111827;
    }

    .step2-card {
      margin-top: 18px;
      border-radius: var(--radius-xl);
      border: 1px solid rgba(148,163,184,0.5);
      background:
        radial-gradient(circle at top left, rgba(15,23,42,0.96), rgba(15,23,42,1));
      padding: 16px 16px 18px;
      display: grid;
      grid-template-columns: minmax(0, 340px) minmax(0, 1fr);
      gap: 18px;
    }
    .step2-left-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .step2-left-sub {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 10px;
    }
    .step2-price-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 14px;
      padding: 10px 12px;
      border: 1px solid rgba(148,163,184,0.7);
      margin-bottom: 8px;
      font-size: 12px;
    }
    .step2-price-amount {
      font-weight: 600;
      color: var(--gold);
    }
    .step2-pay-btn {
      margin-top: 4px;
      width: 100%;
      border-radius: 999px;
      border: none;
      background: linear-gradient(120deg,#22c55e,#16a34a);
      color: #022c22;
      padding: 8px 12px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 14px 40px rgba(6,95,70,0.7);
      transition: all 0.14s ease;
    }
    .step2-pay-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 55px rgba(6,95,70,0.9);
    }
    .step2-pay-note {
      margin-top: 6px;
      font-size: 11px;
      color: var(--text-soft);
    }
    .step2-check-row {
      margin-top: 8px;
      display: flex;
      align-items: flex-start;
      gap: 6px;
      font-size: 11px;
      color: var(--text-soft);
    }
    .step2-check-row input {
      margin-top: 2px;
    }
    .step2-generate-btn {
      margin-top: 10px;
      width: 100%;
      border-radius: 999px;
      border: none;
      background: linear-gradient(120deg,#fbbf24,#f97316);
      color: #111827;
      padding: 8px 14px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 16px 45px rgba(15,23,42,0.9);
      transition: all 0.14s ease;
    }
    .step2-generate-btn[disabled] {
      opacity: 0.6;
      cursor: default;
      box-shadow: 0 8px 18px rgba(15,23,42,0.7);
    }
    .step2-generate-btn:hover:not([disabled]) {
      transform: translateY(-1px);
      box-shadow: 0 20px 65px rgba(15,23,42,1);
    }
    .step2-status {
      margin-top: 6px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .full-output-box {
      border-radius: 14px;
      border: 1px dashed rgba(148, 163, 184, 0.7);
      background: rgba(15,23,42,0.96);
      padding: 10px 12px;
      min-height: 160px;
      max-height: 260px;
      overflow: auto;
      font-size: 12px;
      line-height: 1.5;
      white-space: pre-wrap;
    }
    .full-output-placeholder {
      font-size: 11px;
      color: rgba(191, 219, 254, 0.95);
    }

    @media (max-width: 920px) {
      .desk-layout {
        grid-template-columns: minmax(0, 1fr);
      }
      .ai-panel::after {
        display: none;
      }
      .step2-card {
        grid-template-columns: minmax(0, 1fr);
      }
    }
    @media (max-width: 640px) {
      .desk-main-card {
        padding: 14px 12px 16px;
      }
      .flow-chips {
        grid-template-columns: minmax(0, 1fr);
      }
      .ai-form {
        grid-template-columns: minmax(0, 1fr);
      }
      .ai-footer-row {
        flex-direction: column;
        align-items: flex-start;
      }
      .ai-left-buttons {
        width: 100%;
        justify-content: flex-start;
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body>
  <div class="page-shell">
    <!-- 顶部导航 -->
    <header>
      <div class="brand">
        <div class="brand-mark">
          <div class="brand-mark-inner">AU</div>
        </div>
        <div class="brand-text">
          <div class="brand-title">Aurum Task Desk</div>
          <div class="brand-sub" id="brandSubText">
            Private AI Writing & Resolution Desk
          </div>
        </div>
      </div>
      <nav>
        <div class="nav-links">
          <a href="index.html" class="nav-link" id="navHome">Home</a>
          <a href="desk.html" class="nav-link nav-link--active" id="navDesk">Desk</a>
          <a href="about.html" class="nav-link" id="navAbout">About</a>
          <a href="contact.html" class="nav-link" id="navContact">Contact</a>
        </div>
        <div class="lang-toggle" aria-label="Language">
          <button class="lang-btn active" data-lang="en">EN</button>
          <button class="lang-btn" data-lang="zh">中</button>
        </div>
        <a href="auth.html" class="login-btn">
          <span class="icon">⭑</span>
          <span id="loginBtnText">Login / My Desk</span>
        </a>
      </nav>
    </header>

    <!-- 主体卡片 -->
    <main class="desk-main-card">
      <!-- Flow 头部说明 -->
      <section class="flow-head">
        <div class="flow-head-title-row">
          <div class="flow-title-block">
            <div class="flow-pill">
              <span class="flow-pill-dot"></span>
              <span id="flowPillText">Flow</span>
            </div>
            <div class="flow-title" id="flowTitle">
              Starting a task is intentionally simple
            </div>
            <p class="flow-subtitle" id="flowSubtitle">
              This page lets you pick one serious scenario and open a focused task desk.
              You can always change scenario later — nothing is submitted until you confirm inside your Desk.
            </p>
          </div>
        </div>
        <div class="flow-chips">
          <div class="flow-chip">
            <span class="flow-chip-badge">Step 1</span>
            <span class="label" id="flowChip1Label">Share what happened.</span>
            <span id="flowChip1Text">
              Upload screenshots, letters, or describe the situation in your own words.
            </span>
          </div>
          <div class="flow-chip">
            <span class="flow-chip-badge">Step 2</span>
            <span class="label" id="flowChip2Label">Clarify who and what.</span>
            <span id="flowChip2Text">
              Tell us who you are writing to and what outcome you hope for.
            </span>
          </div>
          <div class="flow-chip">
            <span class="flow-chip-badge">Step 3</span>
            <span class="label" id="flowChip3Label">Receive a ready-to-submit letter.</span>
            <span id="flowChip3Text">
              You review, add personal details if needed, and then send it on.
            </span>
          </div>
        </div>
      </section>

      <!-- 下半部分：左边服务 + 右边 预览窗口 -->
      <section class="desk-layout">
        <!-- 左侧服务列表 -->
        <aside class="service-card">
          <div class="service-card-header">
            <div class="service-card-title" id="serviceCardTitle">
              5 core services
            </div>
            <div class="service-card-mini" id="serviceCardMini">
              Pick one scenario to open a desk
            </div>
          </div>

          <div class="service-list" id="serviceList">
            <button
              type="button"
              class="service-item active"
              data-task="Legal letters & contract drafts"
              data-price="29.9">
              <div class="service-item-main">
                <div class="service-icon-wrap">
                  <div class="service-icon-inner"></div>
                </div>
                <div class="service-text-block">
                  <div class="service-title" id="svc1Title">
                    Legal letters & contract drafts
                  </div>
                  <div class="service-sub" id="svc1Sub">
                    Disputes, refunds, landlord, employer, vendor, partner…
                  </div>
                </div>
              </div>
              <div class="service-price" id="svc1Price">USD 29.9</div>
            </button>

            <button
              type="button"
              class="service-item"
              data-task="Insurance & airline claim letters"
              data-price="29.9">
              <div class="service-item-main">
                <div class="service-icon-wrap">
                  <div class="service-icon-inner"></div>
                </div>
                <div class="service-text-block">
                  <div class="service-title" id="svc2Title">
                    Insurance & airline claim letters
                  </div>
                  <div class="service-sub" id="svc2Sub">
                    Travel disruption, baggage loss, medical & policy claims.
                  </div>
                </div>
              </div>
              <div class="service-price" id="svc2Price">USD 29.9</div>
            </button>

            <button
              type="button"
              class="service-item"
              data-task="Immigration letters & RFE explanations"
              data-price="29.9">
              <div class="service-item-main">
                <div class="service-icon-wrap">
                  <div class="service-icon-inner"></div>
                </div>
                <div class="service-text-block">
                  <div class="service-title" id="svc3Title">
                    Immigration letters & RFE explanations
                  </div>
                  <div class="service-sub" id="svc3Sub">
                    Embassy, USCIS, appeal notes, employer support letters.
                  </div>
                </div>
              </div>
              <div class="service-price" id="svc3Price">USD 29.9</div>
            </button>

            <button
              type="button"
              class="service-item"
              data-task="Family & emotional crisis letters"
              data-price="29.9">
              <div class="service-item-main">
                <div class="service-icon-wrap">
                  <div class="service-icon-inner"></div>
                </div>
                <div class="service-text-block">
                  <div class="service-title" id="svc4Title">
                    Family & emotional crisis letters
                  </div>
                  <div class="service-sub" id="svc4Sub">
                    Calm letters to partners, children, parents & relatives.
                  </div>
                </div>
              </div>
              <div class="service-price" id="svc4Price">USD 29.9</div>
            </button>

            <button
              type="button"
              class="service-item"
              data-task="Complaint & escalation services"
              data-price="29.9">
              <div class="service-item-main">
                <div class="service-icon-wrap">
                  <div class="service-icon-inner"></div>
                </div>
                <div class="service-text-block">
                  <div class="service-title" id="svc5Title">
                    Complaint & escalation services
                  </div>
                  <div class="service-sub" id="svc5Sub">
                    Escalate politely to managers, ombudsman, regulator.
                  </div>
                </div>
              </div>
              <div class="service-price" id="svc5Price">USD 29.9</div>
            </button>
          </div>
        </aside>

        <!-- 右侧 预览窗口 -->
        <section class="ai-panel">
          <div class="ai-header-row">
            <div class="ai-title-block">
              <div class="ai-title" id="aiTitle">
                Preview draft window
                <span class="ai-title-pill" id="aiTitlePill">
                  System only drafts ~30% preview
                </span>
              </div>
              <p class="ai-subtitle" id="aiSubtitle">
                Let the desk draft about 30% of the letter structure and opening for you.
                Nothing is saved or sent. You stay in control of the final version.
              </p>
            </div>
          </div>

          <div class="ai-hint-row">
            <div class="ai-hint-pill" id="aiHint1">
              ✓ No login required for preview
            </div>
            <div class="ai-hint-pill" id="aiHint2">
              ✓ Region-free preview
            </div>
            <div class="ai-hint-pill" id="aiHint3">
              ✓ You can still change everything later
            </div>
          </div>

          <div class="ai-form">
            <div>
              <div class="ai-label">
                <span id="lblTaskType">Task type</span>
                <span class="badge" id="lblTaskTypeBadge">Auto from left</span>
              </div>
              <input
                id="taskTypeInput"
                class="ai-input"
                type="text"
                value="Legal letters & contract drafts"
              />
            </div>

            <div>
              <div class="ai-label">
                <span id="lblLanguage">Language</span>
              </div>
              <select id="languageSelect" class="ai-select">
                <option value="English">English</option>
                <option value="中文">中文</option>
              </select>
            </div>

            <div>
              <div class="ai-label">
                <span id="lblTone">Tone</span>
              </div>
              <select id="toneSelect" class="ai-select">
                <option value="calm, respectful">Calm, respectful</option>
                <option value="firm, polite">Firm, polite</option>
                <option value="urgent but respectful">Urgent but respectful</option>
              </select>
            </div>

            <div>
              <div class="ai-label">
                <span id="lblRecipient">Recipient (optional)</span>
              </div>
              <input
                id="recipientInput"
                class="ai-input"
                type="text"
                placeholder="e.g. airline, landlord, lawyer, embassy"
              />
            </div>

            <div class="ai-form-full">
              <div class="ai-label">
                <span id="lblDetails">What happened? (you can be brief)</span>
              </div>
              <textarea
                id="detailsTextarea"
                class="ai-textarea"
                placeholder="Describe the situation in your own words. You can keep it short; the desk will expand it for you."
              ></textarea>
            </div>

            <div class="ai-form-full">
              <div class="ai-label">
                <span id="lblAttachment">Attachments (optional)</span>
                <span class="badge" id="lblAttachmentBadge">Screenshots, letters, PDF</span>
              </div>
              <input id="attachmentInput" class="ai-input" type="file" multiple />
              <div class="ai-attachment-hint" id="attachmentHint">
                You may upload images or PDF; the desk will read the key text only. Files are not stored.
              </div>
              <div class="ai-attachment-hint" id="uploadFileNameEl"></div>
            </div>
          </div>

          <div class="ai-footer-row">
            <div class="ai-left-buttons">
              <button type="button" class="ai-secondary-btn" id="btnClear">
                <span id="btnClearText">Reset</span>
              </button>
              <button type="button" class="ai-secondary-btn" id="btnPasteExample">
                <span id="btnPasteExampleText">Paste an example case</span>
              </button>
            </div>
            <div class="ai-left-buttons">
              <button type="button" class="ai-generate-btn" id="aiGenerateBtn">
                <span id="aiGenerateBtnText">Generate preview draft</span>
              </button>
              <div class="ai-status" id="aiStatus">
                <span id="aiStatusText">
                  System will draft about 30% of the letter as a preview only.
                </span>
              </div>
            </div>
          </div>

          <!-- 预览 + 模糊遮罩 -->
          <div class="ai-preview-wrapper">
            <div class="ai-preview-box" id="aiPreviewBox">
              <div class="ai-preview-placeholder" id="aiPreviewPlaceholder">
                Your 30% preview draft will appear here. It is not saved or sent
                to any company or person. When you are happy with the direction,
                you can open a full Desk and continue privately.
              </div>
            </div>
            <div class="ai-preview-overlay" id="aiPreviewOverlay">
              <div class="ai-preview-overlay-inner">
                <div class="ai-overlay-title" id="overlayTitle">
                  Preview only shows part of the letter
                </div>
                <div class="ai-overlay-text" id="overlayText">
                  About 30% of the content is visible here. To unlock the full, ready-to-send letter,
                  please scroll down to Step 2 and complete the one-time payment.
                </div>
                <button type="button" class="ai-overlay-btn" id="overlayUpgradeBtn">
                  <span id="overlayBtnText">Go to Step 2 – Payment & full letter</span>
                </button>
              </div>
            </div>
          </div>
        </section>
      </section>

      <!-- Step 2：付款 + 完整信件 -->
      <section class="step2-card" id="step2Card">
        <div>
          <div class="step2-left-title" id="step2Title">Step 2 – Payment & full letter</div>
          <div class="step2-left-sub" id="step2Sub">
            Please pay once to unlock a complete, ready-to-send letter. You can keep this page open
            while paying, then confirm below and generate the full letter.
          </div>
          <div class="step2-price-row">
            <div>
              <div id="step2ScenarioLabel">
                Scenario: <span id="fullScenarioLabel">Legal letters & contract drafts</span>
              </div>
            </div>
            <div class="step2-price-amount" id="fullPriceLabel">USD 29.9</div>
          </div>
          <button type="button" class="step2-pay-btn" id="payBtn">
            <span id="payBtnText">Pay now via Paddle / Wise / PayPal</span>
          </button>
          <div class="step2-pay-note" id="payNoteText">
            Payment will open in a new tab. After completing payment, return to this page,
            tick the confirmation box, then generate your full letter.
          </div>
          <label class="step2-check-row">
            <input type="checkbox" id="payConfirmCheckbox" />
            <span id="payConfirmLabel">
              I confirm I have completed the payment for this full letter.
            </span>
          </label>
          <button type="button" class="step2-generate-btn" id="fullGenerateBtn">
            <span id="fullGenerateBtnText">Generate full letter</span>
          </button>
          <div class="step2-status" id="fullStatusText">
            After payment is confirmed, the system will draft your full letter here.
            Nothing is auto-sent; only you see it.
          </div>
        </div>

        <div>
          <div class="full-output-box" id="fullOutputBox">
            <div class="full-output-placeholder" id="fullOutputPlaceholder">
              Your complete, ready-to-send letter will appear here after Step 2.
              You can copy it into email, PDF, or a system form. The desk never auto-sends on your behalf.
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    const PADDLE_LINK = "https://your-paddle-checkout-link.com"; // TODO: 换成你的 Paddle 支付链接

    const serviceItems = document.querySelectorAll(".service-item");
    const taskTypeInput = document.getElementById("taskTypeInput");

    const aiGenerateBtn = document.getElementById("aiGenerateBtn");
    const aiStatusText = document.getElementById("aiStatusText");
    const aiPreviewBox = document.getElementById("aiPreviewBox");
    const aiPreviewPlaceholder = document.getElementById("aiPreviewPlaceholder");
    const aiPreviewOverlay = document.getElementById("aiPreviewOverlay");
    const overlayUpgradeBtn = document.getElementById("overlayUpgradeBtn");
    const overlayTitle = document.getElementById("overlayTitle");
    const overlayText = document.getElementById("overlayText");
    const overlayBtnText = document.getElementById("overlayBtnText");

    const toneSelect = document.getElementById("toneSelect");
    const languageSelect = document.getElementById("languageSelect");
    const recipientInput = document.getElementById("recipientInput");
    const detailsTextarea = document.getElementById("detailsTextarea");

    const attachmentInput = document.getElementById("attachmentInput");
    const uploadFileNameEl = document.getElementById("uploadFileNameEl");

    const btnClear = document.getElementById("btnClear");
    const btnPasteExample = document.getElementById("btnPasteExample");

    // Step 2
    const fullScenarioLabel = document.getElementById("fullScenarioLabel");
    const fullPriceLabel = document.getElementById("fullPriceLabel");
    const payBtn = document.getElementById("payBtn");
    const payConfirmCheckbox = document.getElementById("payConfirmCheckbox");
    const fullGenerateBtn = document.getElementById("fullGenerateBtn");
    const fullOutputBox = document.getElementById("fullOutputBox");
    const fullOutputPlaceholder = document.getElementById("fullOutputPlaceholder");
    const fullStatusText = document.getElementById("fullStatusText");

    let currentLang = "en";
    let currentPrice = "29.9";

    function syncScenarioAndPrice() {
      fullScenarioLabel.textContent = taskTypeInput.value || "";
      const priceText = "USD " + currentPrice;
      fullPriceLabel.textContent = priceText;
    }

    serviceItems.forEach((btn) => {
      btn.addEventListener("click", () => {
        serviceItems.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        const task = btn.getAttribute("data-task") || "";
        const price = btn.getAttribute("data-price") || currentPrice;
        currentPrice = price;
        if (task) {
          taskTypeInput.value = task;
        }
        syncScenarioAndPrice();
      });
    });
    syncScenarioAndPrice();

    attachmentInput.addEventListener("change", () => {
      const files = attachmentInput.files;
      if (!files || !files.length) {
        uploadFileNameEl.textContent = "";
        return;
      }
      const names = Array.from(files).map((f) => f.name);
      uploadFileNameEl.textContent = names.join(" · ");
    });

    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
          const result = reader.result || "";
          const commaIndex = result.indexOf(",");
          const base64 = commaIndex >= 0 ? result.slice(commaIndex + 1) : result;
          resolve(base64);
        };
        reader.onerror = () => reject(reader.error || new Error("File read error"));
        reader.readAsDataURL(file);
      });
    }

    async function collectAttachments() {
      const files = attachmentInput.files;
      if (!files || !files.length) return [];
      const out = [];
      for (const file of files) {
        const base64 = await fileToBase64(file);
        out.push({
          name: file.name || "attachment",
          type: file.type || "attachment",
          base64
        });
      }
      return out;
    }

    async function callPreview() {
      const taskType  = (taskTypeInput.value || "").trim() || "Writing task";
      const tone      = (toneSelect.value || "calm, respectful").toString();
      const language  = (languageSelect.value || "English").toString();
      const recipient = (recipientInput.value || "").toString();
      const details   = (detailsTextarea.value || "").toString();

      aiGenerateBtn.disabled = true;
      aiStatusText.textContent = language === "中文"
        ? "系统正在生成预览草稿…"
        : "The desk is drafting a preview for you…";

      try {
        const attachments = await collectAttachments();

        const res = await fetch("https://aurum-task-worker.sophieinbg.workers.dev/api/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            taskType,
            tone,
            language,
            recipient,
            details,
            attachments,
            mode: "preview"
          })
        });

        let data = {};
        try {
          data = await res.json();
        } catch (e) {
          data = {};
        }

        if (!res.ok || !data.ok) {
          const errMsg = (data && data.error) ? String(data.error) : ("HTTP " + res.status);
          console.error("Backend error:", errMsg);
          aiStatusText.textContent = language === "中文"
            ? "后端报错：" + errMsg
            : "Backend error: " + errMsg;
          return;
        }

        const fullDraft = String(data.preview || data.draft || data.content || "").trim();
        if (!fullDraft) {
          aiStatusText.textContent = language === "中文"
            ? "后端没有返回预览内容。"
            : "Backend returned no preview content.";
          return;
        }

        // 截断约 35%，保证预览长度适中
        const maxChars = Math.max(400, Math.floor(fullDraft.length * 0.35));
        const previewPart = fullDraft.slice(0, maxChars);

        aiPreviewPlaceholder.style.display = "none";
        aiPreviewBox.textContent = previewPart;

        // 显示遮罩，只盖住下半段
        aiPreviewOverlay.style.display = "flex";

        aiStatusText.textContent = language === "中文"
          ? "预览完成。这里只展示部分内容，完整信件请在下方完成付款后生成。"
          : "Preview ready. Only part of the letter is shown here. Please go to Step 2 below to unlock the full letter.";
      } catch (err) {
        console.error("Frontend error:", err);
        aiStatusText.textContent = language === "中文"
          ? "前端错误：" + (err && err.message ? err.message : String(err))
          : "Frontend error: " + (err && err.message ? err.message : String(err));
      } finally {
        aiGenerateBtn.disabled = false;
      }
    }

    aiGenerateBtn.addEventListener("click", () => {
      callPreview();
    });

    overlayUpgradeBtn.addEventListener("click", () => {
      document.getElementById("step2Card").scrollIntoView({ behavior: "smooth" });
    });

    payBtn.addEventListener("click", () => {
      if (PADDLE_LINK && PADDLE_LINK.startsWith("http")) {
        window.open(PADDLE_LINK, "_blank");
      } else {
        alert("Please configure your Paddle checkout link in desk.html (PADDLE_LINK).");
      }
    });

    async function callFullLetter() {
      const language = (languageSelect.value || "English").toString();

      if (!payConfirmCheckbox.checked) {
        fullStatusText.textContent = language === "中文"
          ? "请先勾选“我确认已经为本次完整信件完成付款”。"
          : "Please tick the confirmation box to confirm you have completed the payment.";
        return;
      }

      const taskType  = (taskTypeInput.value || "").trim() || "Writing task";
      const tone      = (toneSelect.value || "calm, respectful").toString();
      const recipient = (recipientInput.value || "").toString();
      const details   = (detailsTextarea.value || "").toString();

      fullGenerateBtn.disabled = true;
      fullStatusText.textContent = language === "中文"
        ? "正在生成完整信件，请稍候…"
        : "Generating your full letter. Please wait…";

      try {
        const attachments = await collectAttachments();

        const res = await fetch("https://aurum-task-worker.sophieinbg.workers.dev/api/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            taskType,
            tone,
            language,
            recipient,
            details,
            attachments,
            mode: "full"
          })
        });

        let data = {};
        try {
          data = await res.json();
        } catch (e) {
          data = {};
        }

        if (!res.ok || !data.ok) {
          const errMsg = (data && data.error) ? String(data.error) : ("HTTP " + res.status);
          console.error("Backend error:", errMsg);
          fullStatusText.textContent = language === "中文"
            ? "后端报错：" + errMsg
            : "Backend error: " + errMsg;
          return;
        }

        const fullDraft = String(
          data.full ||
          data.content ||
          data.draft ||
          data.preview ||
          ""
        ).trim();

        if (!fullDraft) {
          fullStatusText.textContent = language === "中文"
            ? "后端没有返回完整信件内容。"
            : "Backend returned no full letter content.";
          return;
        }

        fullOutputPlaceholder.style.display = "none";
        fullOutputBox.textContent = fullDraft;
        fullStatusText.textContent = language === "中文"
          ? "完整信件已生成。你可以复制到邮件、PDF 或系统表单中使用。"
          : "Full letter generated. You can copy it into email, PDF, or a system form.";
      } catch (err) {
        console.error("Frontend error:", err);
        fullStatusText.textContent = language === "中文"
          ? "前端错误：" + (err && err.message ? err.message : String(err))
          : "Frontend error: " + (err && err.message ? err.message : String(err));
      } finally {
        fullGenerateBtn.disabled = false;
      }
    }

    fullGenerateBtn.addEventListener("click", () => {
      callFullLetter();
    });

    btnClear.addEventListener("click", () => {
      recipientInput.value = "";
      detailsTextarea.value = "";
      attachmentInput.value = "";
      uploadFileNameEl.textContent = "";
      aiPreviewBox.textContent = "";
      aiPreviewPlaceholder.style.display = "block";
      aiPreviewOverlay.style.display = "none";
      aiStatusText.textContent = languageSelect.value === "中文"
        ? "系统只会生成约 30% 的预览草稿，不会保存也不会发送。"
        : "System will draft about 30% of the letter as a preview only.";
    });

    btnPasteExample.addEventListener("click", () => {
      if (detailsTextarea.value.trim()) return;
      if (languageSelect.value === "中文") {
        detailsTextarea.value =
          "我与贵公司就某项长期服务合同发生严重争议，多次催促未果，现在需要一封正式信件向贵司提出严肃的书面申诉，并保留进一步法律行动的权利。";
      } else {
        detailsTextarea.value =
          "I need to raise a serious dispute regarding long-overdue payments. The other side has ignored reminders and I am now considering formal legal action.";
      }
    });

    const langButtons = document.querySelectorAll(".lang-btn");
    const i18n = {
      en: {
        brandSub: "Private writing & resolution desk",
        navHome: "Home",
        navDesk: "Desk",
        navAbout: "About",
        navContact: "Contact",
        loginBtn: "Login / My Desk",
        flowPill: "Flow",
        flowTitle: "Starting a task is intentionally simple",
        flowSubtitle:
          "This page lets you pick one serious scenario and open a focused task desk. You can always change scenario later — nothing is submitted until you confirm inside your Desk.",
        chip1Label: "Share what happened.",
        chip1Text:
          "Upload screenshots, letters, or describe the situation in your own words.",
        chip2Label: "Clarify who and what.",
        chip2Text:
          "Tell us who you are writing to and what outcome you hope for.",
        chip3Label: "Receive a ready-to-submit letter.",
        chip3Text:
          "You review, add personal details if needed, and then send it on.",
        serviceCardTitle: "5 core services",
        serviceCardMini: "Pick one scenario to open a desk",
        aiTitle: "Preview draft window",
        aiTitlePill: "System only drafts ~30% preview",
        aiSubtitle:
          "Let the desk draft about 30% of the letter structure and opening for you. Nothing is saved or sent.",
        aiHint1: "✓ No login required for preview",
        aiHint2: "✓ Region-free preview",
        aiHint3: "✓ You can still change everything later",
        lblTaskType: "Task type",
        lblTaskTypeBadge: "Auto from left",
        lblLanguage: "Language",
        lblTone: "Tone",
        lblRecipient: "Recipient (optional)",
        lblDetails: "What happened? (you can be brief)",
        lblAttachment: "Attachments (optional)",
        lblAttachmentBadge: "Screenshots, letters, PDF",
        attachmentHint:
          "You may upload images or PDF; the desk will read the key text only. Files are not stored.",
        btnClear: "Reset",
        btnExample: "Paste an example case",
        btnPreview: "Generate preview draft",
        statusDefault:
          "System will draft about 30% of the letter as a preview only.",
        previewPlaceholder:
          "Your 30% preview draft will appear here. It is not saved or sent to anyone. When you are happy with the direction, you can open a full Desk and continue privately.",
        overlayTitle: "Preview only shows part of the letter",
        overlayText:
          "About 30% of the content is visible here. To unlock the full, ready-to-send letter, please scroll down to Step 2 and complete the one-time payment.",
        overlayBtnText: "Go to Step 2 – Payment & full letter",
        step2Title: "Step 2 – Payment & full letter",
        step2Sub:
          "Please pay once to unlock a complete, ready-to-send letter. You can keep this page open while paying, then confirm below and generate the full letter.",
        payBtnText: "Pay now via Paddle / Wise / PayPal",
        payNoteText:
          "Payment will open in a new tab. After completing payment, return to this page, tick the confirmation box, then generate your full letter.",
        payConfirmLabel:
          "I confirm I have completed the payment for this full letter.",
        fullGenerateBtnText: "Generate full letter",
        fullStatusDefault:
          "After payment is confirmed, the system will draft your full letter here. Nothing is auto-sent; only you see it.",
        fullOutputPlaceholder:
          "Your complete, ready-to-send letter will appear here after Step 2. You can copy it into email, PDF, or a system form. The desk never auto-sends on your behalf."
      },
      zh: {
        brandSub: "安静而专业的写作与申诉任务台",
        navHome: "首页",
        navDesk: "Desk 任务台",
        navAbout: "关于我们",
        navContact: "联系我们",
        loginBtn: "登录 / 我的 Desk",
        flowPill: "流程",
        flowTitle: "开始一个任务，被刻意设计得很简单",
        flowSubtitle:
          "在这里，你只需先选一个最重要的场景，打开一个专注的任务台。后面随时可以调整场景，只有在你确认后才会正式提交。",
        chip1Label: "先说清楚发生了什么。",
        chip1Text:
          "可以上传截图、信件，或者用你自己的话简单描述情况，不需要完美。",
        chip2Label: "再说明对象和诉求。",
        chip2Text:
          "告诉我们你要写给谁（律师、领馆、保险公司、雇主、航空公司等）以及理想结果。",
        chip3Label: "拿到一封可以直接递交的信。",
        chip3Text:
          "你可以再补充个人信息、删改语气，确认后再通过邮箱、系统或打印寄出。",
        serviceCardTitle: "5 个核心服务场景",
        serviceCardMini: "先选一个场景打开任务台",
        aiTitle: "预览草稿小窗口",
        aiTitlePill: "系统只会生成约 30% 预览草稿",
        aiSubtitle:
          "先让任务台替你起一段大约 30% 的结构和开头。此步骤不会保存，也不会发送给任何机构。",
        aiHint1: "✓ 无需登录即可预览",
        aiHint2: "✓ 无地区限制预览",
        aiHint3: "✓ 后面可以随时全部修改",
        lblTaskType: "任务类型",
        lblTaskTypeBadge: "从左侧自动带入",
        lblLanguage: "写作语言",
        lblTone: "语气",
        lblRecipient: "收件方（可选）",
        lblDetails: "简单讲讲发生了什么",
        lblAttachment: "上传附件（可选）",
        lblAttachmentBadge: "截图、信件、PDF 文件",
        attachmentHint:
          "可以上传图片或 PDF，系统只会抽取关键信息，不会长期保存原文件。",
        btnClear: "Reset",
        btnExample: "粘贴一个示例案例",
        btnPreview: "生成预览草稿",
        statusDefault:
          "系统只会生成约 30% 的预览草稿，不会保存也不会发送。",
        previewPlaceholder:
          "系统生成的大约 30% 预览内容会显示在这里。它不会被保存，也不会发给任何人。确认方向后，你可以在完整任务台中更私密地继续完善。",
        overlayTitle: "这里只展示部分预览内容",
        overlayText:
          "目前你看到的大约是整封信的 30%。如需查看完整、可直接递交的正式信件，请下滑到第 2 步完成一次性付款，再生成完整信件。",
        overlayBtnText: "前往第 2 步：付款并解锁完整信件",
        step2Title: "第 2 步 – 付款并解锁完整信件",
        step2Sub:
          "为这一封正式信件支付一次费用后，你可以在这里一封一封地生成可以直接递交的完整信件。付款时可以保持此页面打开。",
        payBtnText: "通过 Paddle / Wise / PayPal 立即付款",
        payNoteText:
          "付款会在新标签页中打开安全收款链接。支付完成后，请回到此页面勾选确认，然后生成完整信件。",
        payConfirmLabel:
          "我确认已经为本次完整信件完成付款。",
        fullGenerateBtnText: "生成完整信件",
        fullStatusDefault:
          "确认付款后，系统会在此处生成一封完整信件。不会自动发送，只会展示给你。",
        fullOutputPlaceholder:
          "完成第 2 步后，系统生成的完整信件会显示在这里。你可以复制到邮件、PDF 或系统表单中使用，系统不会替你自动发送。"
      }
    };

    // ==== 登录状态：从 auth.html 写入的 aurum_user 里读取 ====
    const USER_STORAGE_KEY = "aurum_user";

    function getCurrentUser() {
      try {
        const raw = localStorage.getItem(USER_STORAGE_KEY);
        if (!raw) return null;
        return JSON.parse(raw);
      } catch {
        return null;
      }
    }

    function applyLoginState() {
      const loginBtn = document.querySelector(".login-btn");
      const loginTextEl = document.getElementById("loginBtnText");
      if (!loginBtn || !loginTextEl) return;

      const user = getCurrentUser();
      const t = (i18n[currentLang] || i18n.en);

      if (user && user.name) {
        const name = String(user.name).slice(0, 18);
        const hiText = currentLang === "zh" ? "Hi, " + name : "Hi, " + name;
        loginTextEl.textContent = hiText;
        loginBtn.href = "desk.html"; // 已登录时直接进 Desk
      } else {
        loginTextEl.textContent = t.loginBtn;
        loginBtn.href = "auth.html"; // 未登录时去登录页
      }
    }
    // ==== 登录状态 END ====

    function applyLang(lang) {
      const t = i18n[lang] || i18n.en;
      currentLang = lang;

      document.getElementById("brandSubText").textContent = t.brandSub;
      document.getElementById("navHome").textContent = t.navHome;
      document.getElementById("navDesk").textContent = t.navDesk;
      document.getElementById("navAbout").textContent = t.navAbout;
      document.getElementById("navContact").textContent = t.navContact;
      document.getElementById("loginBtnText").textContent = t.loginBtn;

      document.getElementById("flowPillText").textContent = t.flowPill;
      document.getElementById("flowTitle").textContent = t.flowTitle;
      document.getElementById("flowSubtitle").textContent = t.flowSubtitle;
      document.getElementById("flowChip1Label").textContent = t.chip1Label;
      document.getElementById("flowChip1Text").textContent = t.chip1Text;
      document.getElementById("flowChip2Label").textContent = t.chip2Label;
      document.getElementById("flowChip2Text").textContent = t.chip2Text;
      document.getElementById("flowChip3Label").textContent = t.chip3Label;
      document.getElementById("flowChip3Text").textContent = t.chip3Text;

      document.getElementById("serviceCardTitle").textContent = t.serviceCardTitle;
      document.getElementById("serviceCardMini").textContent = t.serviceCardMini;

      document.getElementById("aiTitle").firstChild.textContent = t.aiTitle + " ";
      document.getElementById("aiTitlePill").textContent = t.aiTitlePill;
      document.getElementById("aiSubtitle").textContent = t.aiSubtitle;
      document.getElementById("aiHint1").textContent = t.aiHint1;
      document.getElementById("aiHint2").textContent = t.aiHint2;
      document.getElementById("aiHint3").textContent = t.aiHint3;

      document.getElementById("lblTaskType").textContent = t.lblTaskType;
      document.getElementById("lblTaskTypeBadge").textContent = t.lblTaskTypeBadge;
      document.getElementById("lblLanguage").textContent = t.lblLanguage;
      document.getElementById("lblTone").textContent = t.lblTone;
      document.getElementById("lblRecipient").textContent = t.lblRecipient;
      document.getElementById("lblDetails").textContent = t.lblDetails;
      document.getElementById("lblAttachment").textContent = t.lblAttachment;
      document.getElementById("lblAttachmentBadge").textContent = t.lblAttachmentBadge;
      document.getElementById("attachmentHint").textContent = t.attachmentHint;

      document.getElementById("btnClearText").textContent = t.btnClear;
      document.getElementById("btnPasteExampleText").textContent = t.btnExample;
      document.getElementById("aiGenerateBtnText").textContent = t.btnPreview;
      document.getElementById("aiStatusText").textContent = t.statusDefault;
      document.getElementById("aiPreviewPlaceholder").textContent = t.previewPlaceholder;

      overlayTitle.textContent = t.overlayTitle;
      overlayText.textContent = t.overlayText;
      overlayBtnText.textContent = t.overlayBtnText;

      document.getElementById("step2Title").textContent = t.step2Title;
      document.getElementById("step2Sub").textContent = t.step2Sub;
      document.getElementById("payBtnText").textContent = t.payBtnText;
      document.getElementById("payNoteText").textContent = t.payNoteText;
      document.getElementById("payConfirmLabel").textContent = t.payConfirmLabel;
      document.getElementById("fullGenerateBtnText").textContent = t.fullGenerateBtnText;
      document.getElementById("fullStatusText").textContent = t.fullStatusDefault;
      document.getElementById("fullOutputPlaceholder").textContent = t.fullOutputPlaceholder;

      langButtons.forEach((b) => {
        b.classList.toggle("active", b.dataset.lang === lang);
      });

      if (lang === "zh") {
        languageSelect.value = "中文";
        document.documentElement.lang = "zh-CN";
      } else {
        languageSelect.value = "English";
        document.documentElement.lang = "en";
      }

      syncScenarioAndPrice();
      localStorage.setItem("aurum_lang", lang);

      // 语言切换时同步更新登录按钮文字
      applyLoginState();
    }

    langButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const lang = btn.dataset.lang || "en";
        applyLang(lang);
      });
    });

    (function initLang() {
      const saved = localStorage.getItem("aurum_lang");
      if (saved === "zh" || saved === "en") {
        applyLang(saved);
      } else {
        applyLang("en");
      }
    })();
  </script>
</body>
</html>
