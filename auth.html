<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Aurum Task Desk — 登录 / 注册</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Favicon -->
  <link rel="icon" href="favicon.png" />
  <link rel="icon" type="image/png" href="favicon.png" />

  <!-- Google tag (保持你以前的统计，如果不需要可以删掉) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-NEY7RNB5S"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-NEY7RNB5S');
  </script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",system-ui,sans-serif;
      min-height: 100vh;
      background: radial-gradient(circle at top, #020617 0%, #020617 40%, #000 100%);
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    .shell {
      width: 100%;
      max-width: 960px;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 0;
      border-radius: 24px;
      overflow: hidden;
      background: radial-gradient(circle at top left, #020617 0%, #020617 55%, #000 100%);
      box-shadow:
        0 22px 50px rgba(0,0,0,0.7),
        0 0 0 1px rgba(148,163,184,0.35);
    }
    @media (max-width: 768px) {
      .shell {
        grid-template-columns: minmax(0,1fr);
      }
      .hero {
        display: none;
      }
    }

    .hero {
      position: relative;
      padding: 26px 26px 24px;
      border-right: 1px solid rgba(51,65,85,0.7);
      background:
        radial-gradient(circle at 0% 0%, rgba(56,189,248,0.22) 0, transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(250,204,21,0.26) 0, transparent 50%),
        linear-gradient(135deg,#020617 0%,#020617 50%,#000 100%);
    }
    .hero-pill {
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 12px;
      border-radius:999px;
      border:1px solid rgba(248,250,252,0.14);
      background:rgba(15,23,42,0.9);
      backdrop-filter: blur(14px);
    }
    .hero-pill span {
      font-size:11px;
      letter-spacing:0.18em;
      text-transform:uppercase;
      color:#e5e7eb;
    }
    .hero-pill-badge {
      width:18px;
      height:18px;
      border-radius:999px;
      background:conic-gradient(from 220deg,#facc15,#f97316,#22c55e,#0ea5e9,#facc15);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:11px;
      color:#020617;
      font-weight:700;
    }
    .hero-title {
      margin-top:18px;
      font-size:26px;
      line-height:1.25;
      font-weight:650;
      color:#f9fafb;
    }
    .hero-sub {
      margin-top:10px;
      font-size:13px;
      line-height:1.7;
      color:#cbd5f5;
      max-width:360px;
    }
    .hero-meta {
      margin-top:22px;
      display:flex;
      flex-wrap:wrap;
      gap:14px;
      font-size:12px;
      color:#9ca3af;
    }
    .hero-meta-item strong {
      display:block;
      font-size:13px;
      color:#e5e7eb;
    }
    .hero-footer {
      position:absolute;
      left:26px;
      right:26px;
      bottom:18px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:11px;
      color:#9ca3af;
    }
    .hero-footer span.highlight {
      color:#facc15;
      font-weight:600;
    }

    .card {
      padding: 24px 24px 20px;
      background: radial-gradient(circle at top, #020617 0%, #020617 52%, #020617 100%);
    }

    .logo-row {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:18px;
    }
    .logo-main {
      display:flex;
      align-items:center;
      gap:10px;
    }
    .logo-icon {
      width:34px;
      height:34px;
      border-radius:14px;
      background:conic-gradient(from 220deg,#facc15,#f97316,#22c55e,#0ea5e9,#facc15);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      color:#020617;
      font-size:18px;
    }
    .logo-text-main {
      font-size:15px;
      font-weight:600;
      color:#f9fafb;
    }
    .logo-text-sub {
      font-size:11px;
      color:#9ca3af;
    }
    .nav-back {
      font-size:12px;
      color:#93c5fd;
      text-decoration:none;
    }
    .nav-back:hover { text-decoration:underline; }

    .tabs {
      display:flex;
      gap:4px;
      padding:4px;
      border-radius:999px;
      background:rgba(15,23,42,0.92);
      border:1px solid rgba(148,163,184,0.45);
      margin-bottom:18px;
    }
    .tab-btn {
      flex:1;
      border:none;
      background:transparent;
      color:#9ca3af;
      font-size:12px;
      padding:6px 0;
      border-radius:999px;
      cursor:pointer;
      transition:all 0.16s ease-out;
    }
    .tab-btn.active {
      background:linear-gradient(135deg,#facc15,#fbbf24);
      color:#020617;
      font-weight:600;
      box-shadow:0 10px 20px rgba(0,0,0,0.6);
    }

    .tab-panel { display:none; }
    .tab-panel.active { display:block; }

    .field-group {
      margin-bottom:12px;
    }
    .field-label {
      font-size:12px;
      color:#e5e7eb;
      margin-bottom:4px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .field-label span.sub {
      font-size:11px;
      color:#9ca3af;
    }
    .field-input {
      width:100%;
      padding:9px 10px;
      border-radius:9px;
      border:1px solid rgba(148,163,184,0.55);
      background:rgba(15,23,42,0.85);
      color:#e5e7eb;
      font-size:13px;
      outline:none;
    }
    .field-input:focus {
      border-color:#facc15;
      box-shadow:0 0 0 1px rgba(250,204,21,0.4);
    }

    .field-inline {
      display:flex;
      gap:8px;
    }
    .field-inline input {
      flex:1;
    }
    .btn {
      width:100%;
      margin-top:8px;
      padding:9px 12px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      font-size:13px;
      font-weight:600;
      letter-spacing:0.03em;
      text-transform:uppercase;
      background:linear-gradient(135deg,#facc15,#fbbf24);
      color:#020617;
      box-shadow:0 16px 30px rgba(0,0,0,0.6);
      transition:transform 0.1s ease-out, box-shadow 0.1s ease-out;
    }
    .btn:hover {
      transform:translateY(-1px);
      box-shadow:0 20px 35px rgba(0,0,0,0.7);
    }
    .btn.secondary {
      margin-top:6px;
      background:transparent;
      color:#e5e7eb;
      border:1px solid rgba(148,163,184,0.7);
      box-shadow:none;
      text-transform:none;
      letter-spacing:0;
      font-weight:500;
    }
    .btn.secondary:hover {
      background:rgba(15,23,42,0.9);
    }

    .helper-row {
      margin-top:8px;
      display:flex;
      justify-content:space-between;
      font-size:11px;
      color:#9ca3af;
    }
    .helper-row a {
      color:#93c5fd;
      text-decoration:none;
      cursor:pointer;
    }
    .helper-row a:hover { text-decoration:underline; }

    .status {
      margin-top:8px;
      font-size:12px;
      min-height:16px;
    }
    .status.ok { color:#bbf7d0; }
    .status.err { color:#fecaca; }

    .small-note {
      margin-top:12px;
      font-size:11px;
      color:#6b7280;
      line-height:1.6;
    }
  </style>
</head>
<body>
  <div class="shell">
    <!-- 左侧品牌 / 说明 -->
    <div class="hero">
      <div class="hero-pill">
        <div class="hero-pill-badge">A</div>
        <span>Aurum Private Task Desk</span>
      </div>
      <div class="hero-title">
        安静一点，先把登录搞定。<br />
        后面所有信件和任务，都在这里接入。
      </div>
      <p class="hero-sub">
        这个登录系统连接的是同一个 Aurum 任务台：<br />
        你在首页、任务台、定价页看到的登录状态，会保持同步。
      </p>
      <div class="hero-meta">
        <div class="hero-meta-item">
          <strong>电邮 + 密码 + 验证码</strong>
          一套账号，走遍整个站。
        </div>
        <div class="hero-meta-item">
          <strong>不放公开 AI 提示词</strong>
          只在你自己的桌面里用。
        </div>
      </div>
      <div class="hero-footer">
        <span>适合欧美 40+ 用户的安静登录体验。</span>
        <span class="highlight">Aurum Desk · Private Sign-in</span>
      </div>
    </div>

    <!-- 右侧登录卡片 -->
    <div class="card">
      <div class="logo-row">
        <div class="logo-main">
          <div class="logo-icon">A</div>
          <div>
            <div class="logo-text-main">Aurum Task Desk</div>
            <div class="logo-text-sub">Private AI writing & task desk</div>
          </div>
        </div>
        <a href="index.html" class="nav-back">← 返回首页</a>
      </div>

      <!-- 标签切换 -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="login">登录</button>
        <button class="tab-btn" data-tab="register">注册</button>
        <button class="tab-btn" data-tab="reset">重设密码</button>
      </div>

      <!-- 登录 -->
      <div class="tab-panel active" id="tab-login">
        <div class="field-group">
          <div class="field-label">邮箱</div>
          <input type="email" id="login-email" class="field-input" placeholder="you@example.com" />
        </div>
        <div class="field-group">
          <div class="field-label">
            密码
            <span class="sub">至少 6 位</span>
          </div>
          <input type="password" id="login-password" class="field-input" placeholder="••••••••" />
        </div>
        <button class="btn" id="btn-login">登录</button>
        <div class="helper-row">
          <span></span>
          <a data-switch-tab="reset">忘记密码？</a>
        </div>
        <div class="status" id="login-status"></div>
      </div>

      <!-- 注册 -->
      <div class="tab-panel" id="tab-register">
        <div class="field-group">
          <div class="field-label">
            名称
            <span class="sub">用于登录后显示，例如 “John”</span>
          </div>
          <input type="text" id="reg-name" class="field-input" placeholder="Your name" />
        </div>
        <div class="field-group">
          <div class="field-label">邮箱</div>
          <input type="email" id="reg-email" class="field-input" placeholder="you@example.com" />
        </div>
        <div class="field-group">
          <div class="field-label">
            密码
            <span class="sub">至少 6 位</span>
          </div>
          <input type="password" id="reg-password" class="field-input" placeholder="••••••••" />
        </div>
        <div class="field-group">
          <div class="field-label">
            邮箱验证码
            <span class="sub">
              <button id="btn-send-code" type="button" style="all:unset;cursor:pointer;color:#93c5fd;font-size:11px;">
                发送验证码
              </button>
            </span>
          </div>
          <div class="field-inline">
            <input type="text" id="reg-code" class="field-input" placeholder="6 位数字" />
          </div>
        </div>
        <button class="btn" id="btn-register">完成注册</button>
        <div class="helper-row">
          <span></span>
          <a data-switch-tab="login">已有账号？去登录</a>
        </div>
        <div class="status" id="reg-status"></div>
      </div>

      <!-- 重设密码 -->
      <div class="tab-panel" id="tab-reset">
        <div class="field-group">
          <div class="field-label">注册邮箱</div>
          <input type="email" id="reset-email" class="field-input" placeholder="you@example.com" />
        </div>
        <div class="field-group">
          <div class="field-label">
            新密码
            <span class="sub">至少 6 位</span>
          </div>
          <input type="password" id="reset-password" class="field-input" placeholder="新的密码" />
        </div>
        <div class="field-group">
          <div class="field-label">
            邮箱验证码
            <span class="sub">
              <button id="btn-send-reset-code" type="button" style="all:unset;cursor:pointer;color:#93c5fd;font-size:11px;">
                发送验证码
              </button>
            </span>
          </div>
          <input type="text" id="reset-code" class="field-input" placeholder="6 位数字" />
        </div>
        <button class="btn" id="btn-reset">确认重设密码</button>
        <div class="helper-row">
          <span></span>
          <a data-switch-tab="login">返回登录</a>
        </div>
        <div class="status" id="reset-status"></div>
      </div>

      <div class="small-note">
        登录后，你的账号信息会保存在浏览器的本地存储（localStorage）中，用于在首页、任务台、定价页显示
        “Hi, 你的名字” 和退出登录按钮。<br />
        不会向第三方广告平台泄露你的任务内容。
      </div>
    </div>
  </div>

  <script>
    // 统一 API：用相对路径，走到同域 Worker（你现在的 Worker 已经有 /auth/* 这些路由）
    const STORAGE_KEY = "aurum_user";
    let registerToken = ""; // 保存 /auth/send-code 返回的 token
    let resetToken = "";    // 保存重设密码时收到的 token（方案：也用 send-code + token，可以复用）

    // 简单切 tab
    const tabButtons = document.querySelectorAll(".tab-btn");
    const tabPanels = document.querySelectorAll(".tab-panel");
    function activateTab(id) {
      tabButtons.forEach(btn => {
        btn.classList.toggle("active", btn.dataset.tab === id);
      });
      tabPanels.forEach(p => {
        p.classList.toggle("active", p.id === "tab-" + id);
      });
      // 清状态
      document.getElementById("login-status").textContent = "";
      document.getElementById("reg-status").textContent = "";
      document.getElementById("reset-status").textContent = "";
    }
    tabButtons.forEach(btn => {
      btn.addEventListener("click", () => activateTab(btn.dataset.tab));
    });
    document.querySelectorAll("[data-switch-tab]").forEach(a => {
      a.addEventListener("click", () => activateTab(a.getAttribute("data-switch-tab")));
    });

    // 简单封装 fetch
    async function postJSON(path, data) {
      const res = await fetch(path, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data || {})
      });
      const json = await res.json().catch(() => ({}));
      return { ok: res.ok && json.ok !== false, status: res.status, data: json };
    }

    // 保存 / 读取当前用户
    function saveUser(user) {
      if (!user) return;
      localStorage.setItem(STORAGE_KEY, JSON.stringify(user));
    }
    function getUser() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return null;
        return JSON.parse(raw);
      } catch {
        return null;
      }
    }

    // 登录按钮
    document.getElementById("btn-login").addEventListener("click", async () => {
      const email = document.getElementById("login-email").value.trim().toLowerCase();
      const password = document.getElementById("login-password").value.trim();
      const statusEl = document.getElementById("login-status");
      statusEl.textContent = "正在登录…";
      statusEl.className = "status";

      if (!email || !password) {
        statusEl.textContent = "请输入邮箱和密码。";
        statusEl.classList.add("err");
        return;
      }

      const { ok, data } = await postJSON("/auth/login", { email, password });
      if (!ok || !data.ok) {
        statusEl.textContent = data.error || "登录失败，请检查邮箱和密码。";
        statusEl.classList.add("err");
        return;
      }

      saveUser(data.user);
      statusEl.textContent = "登录成功，正在跳转…";
      statusEl.classList.add("ok");

      // 跳回任务台或首页
      setTimeout(() => {
        // 你可以改成 desk.html
        window.location.href = "desk.html";
      }, 600);
    });

    // 发送注册验证码
    let codeTimer = null;
    function startCountdown(btn) {
      let left = 60;
      btn.disabled = true;
      const origText = "发送验证码";
      const tick = () => {
        btn.textContent = left + " 秒后可重发";
        left--;
        if (left < 0) {
          btn.disabled = false;
          btn.textContent = origText;
          clearInterval(codeTimer);
        }
      };
      tick();
      codeTimer = setInterval(tick, 1000);
    }

    document.getElementById("btn-send-code").addEventListener("click", async () => {
      const email = document.getElementById("reg-email").value.trim().toLowerCase();
      const statusEl = document.getElementById("reg-status");
      if (!email || !email.includes("@")) {
        statusEl.textContent = "请先填写正确的邮箱。";
        statusEl.className = "status err";
        return;
      }
      statusEl.textContent = "正在发送验证码…";
      statusEl.className = "status";

      const { ok, data } = await postJSON("/auth/send-code", { email });
      if (!ok || !data.ok) {
        statusEl.textContent = data.error || "验证码发送失败，请稍后重试。";
        statusEl.classList.add("err");
        return;
      }
      registerToken = data.token;
      statusEl.textContent = "验证码已发送到邮箱，请在 10 分钟内填写。";
      statusEl.classList.add("ok");
      startCountdown(document.getElementById("btn-send-code"));
    });

    // 注册
    document.getElementById("btn-register").addEventListener("click", async () => {
      const name = document.getElementById("reg-name").value.trim();
      const email = document.getElementById("reg-email").value.trim().toLowerCase();
      const password = document.getElementById("reg-password").value.trim();
      const code = document.getElementById("reg-code").value.trim();
      const statusEl = document.getElementById("reg-status");
      statusEl.textContent = "正在注册…";
      statusEl.className = "status";

      if (!name || !email || !password || !code) {
        statusEl.textContent = "请完整填写名称、邮箱、密码和验证码。";
        statusEl.classList.add("err");
        return;
      }
      if (password.length < 6) {
        statusEl.textContent = "密码至少 6 位。";
        statusEl.classList.add("err");
        return;
      }
      if (!registerToken) {
        statusEl.textContent = "请先点击“发送验证码”。";
        statusEl.classList.add("err");
        return;
      }

      const { ok, data } = await postJSON("/auth/register", {
        name,
        email,
        password,
        code,
        token: registerToken
      });

      if (!ok || !data.ok) {
        statusEl.textContent = data.error || "注册失败，请稍后重试。";
        statusEl.classList.add("err");
        return;
      }

      saveUser(data.user);
      statusEl.textContent = "注册成功，已自动登录，正在跳转…";
      statusEl.classList.add("ok");

      setTimeout(() => {
        window.location.href = "desk.html";
      }, 700);
    });

    // 重设密码：先发验证码
    document.getElementById("btn-send-reset-code").addEventListener("click", async () => {
      const email = document.getElementById("reset-email").value.trim().toLowerCase();
      const statusEl = document.getElementById("reset-status");
      if (!email || !email.includes("@")) {
        statusEl.textContent = "请先填写注册邮箱。";
        statusEl.className = "status err";
        return;
      }
      statusEl.textContent = "正在发送验证码…";
      statusEl.className = "status";

      const { ok, data } = await postJSON("/auth/send-code", { email });
      if (!ok || !data.ok) {
        statusEl.textContent = data.error || "验证码发送失败，请稍后重试。";
        statusEl.classList.add("err");
        return;
      }
      resetToken = data.token;
      statusEl.textContent = "验证码已发送到邮箱，请在 10 分钟内填写。";
      statusEl.classList.add("ok");
      startCountdown(document.getElementById("btn-send-reset-code"));
    });

    // 重设密码提交
    document.getElementById("btn-reset").addEventListener("click", async () => {
      const email = document.getElementById("reset-email").value.trim().toLowerCase();
      const newPassword = document.getElementById("reset-password").value.trim();
      const code = document.getElementById("reset-code").value.trim();
      const statusEl = document.getElementById("reset-status");

      statusEl.textContent = "正在重设密码…";
      statusEl.className = "status";

      if (!email || !newPassword || !code) {
        statusEl.textContent = "请填写邮箱、新密码和验证码。";
        statusEl.classList.add("err");
        return;
      }
      if (newPassword.length < 6) {
        statusEl.textContent = "新密码至少 6 位。";
        statusEl.classList.add("err");
        return;
      }
      if (!resetToken) {
        statusEl.textContent = "请先点击“发送验证码”。";
        statusEl.classList.add("err");
        return;
      }

      const { ok, data } = await postJSON("/auth/reset-password", {
        email,
        newPassword,
        code,
        token: resetToken
      });

      if (!ok || !data.ok) {
        statusEl.textContent = data.error || "重设失败，请稍后重试。";
        statusEl.classList.add("err");
        return;
      }

      statusEl.textContent = "密码已重设成功，请用新密码登录。";
      statusEl.classList.add("ok");
      setTimeout(() => activateTab("login"), 800);
    });

    // 如果已经登录，直接提示
    window.addEventListener("DOMContentLoaded", () => {
      const u = getUser();
      if (u && u.email) {
        const s = document.getElementById("login-status");
        s.textContent = "你已经登录为：" + (u.name || u.email) + "。如需切换账号，可以先退出登录。";
        s.className = "status ok";
      }
    });
  </script>
</body>
</html>
